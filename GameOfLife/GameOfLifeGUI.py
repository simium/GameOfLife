import pygame
import pygame.locals

from GameOfLife import Universe

def load_tile_table(filename, width, height):
    image = pygame.image.load(filename).convert()
    image_width, image_height = image.get_size()
    tile_table = []
    for tile_x in range(0, image_width/width):
        line = []
        tile_table.append(line)
        for tile_y in range(0, image_height/height):
            rect = (tile_x*width, tile_y*height, width, height)
            line.append(image.subsurface(rect))
    return tile_table

if __name__=='__main__':
    
    
    universe = Universe(isFiniteWorld=False)
#     universe.populate([[0,0,0,0,0,0],
#                        [0,0,0,1,0,0],
#                        [0,1,0,0,1,0],
#                        [0,1,0,0,1,0],
#                        [0,0,1,0,0,0],
#                        [0,0,0,0,0,0]])

#     universe.populate([[0,0,0,0,0,0],
#                        [0,0,0,1,0,0],
#                        [0,0,0,0,1,0],
#                        [0,0,1,1,1,0],
#                        [0,0,0,0,0,0],
#                        [0,0,0,0,0,0]])
    
#     universe.populate([[0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
#                        [0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0],
#                        [1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0],
#                        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
#                        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
#                        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
#                        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
#                        [0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0],
#                        [0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0],
#                        [0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0],
#                        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
#                        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
#                        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
#                        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
#                        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
#                        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]])

#     universe.populate([[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
#                        [1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0],
#                        [0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0],
#                        [1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0],
#                        [0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0],
#                        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
#                        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
#                        [0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0],
#                        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
#                        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
#                        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
#                        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
#                        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
#                        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
#                        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
#                        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]])

    universe.populate([[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
                       [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
                       [0,0,0,0,1,1,1,0,0,0,1,1,1,0,0,0],
                       [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
                       [0,0,1,0,0,0,0,1,0,1,0,0,0,0,1,0],
                       [0,0,1,0,0,0,0,1,0,1,0,0,0,0,1,0],
                       [0,0,1,0,0,0,0,1,0,1,0,0,0,0,1,0],
                       [0,0,0,0,1,1,1,0,0,0,1,1,1,0,0,0],
                       [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
                       [0,0,0,0,1,1,1,0,0,0,1,1,1,0,0,0],
                       [0,0,1,0,0,0,0,1,0,1,0,0,0,0,1,0],
                       [0,0,1,0,0,0,0,1,0,1,0,0,0,0,1,0],
                       [0,0,1,0,0,0,0,1,0,1,0,0,0,0,1,0],
                       [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
                       [0,0,0,0,1,1,1,0,0,0,1,1,1,0,0,0],
                       [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]])
    
#     universe.populate([[0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0],
#                        [0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0],
#                        [1,1,1,0,0,0,1,1,1,0,0,0,0,0,0,0],
#                        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
#                        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
#                        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
#                        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
#                        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
#                        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
#                        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
#                        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
#                        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
#                        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
#                        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
#                        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
#                        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]])
    
    pygame.init()
    screen = pygame.display.set_mode((universe.width*32, universe.height*32))
    screen.fill((255, 255, 255))
    pygame.display.set_caption('Game of Life')
    
    table = load_tile_table("ground.png", 32, 32)

    clock = pygame.time.Clock()
    
    game_over = False
    while not game_over:
        universe.evolve()
        bitmap = universe.bitmap
        for i in range(universe.height):
            for j in range(universe.width):
                if bitmap[i][j] == 0:
                    screen.blit(table[0][0], (j*32, i*32))
                else:
                    screen.blit(table[1][0], (j*32, i*32))
        pygame.display.flip()
        
        clock.tick(12)
        
        for event in pygame.event.get():
            if event.type == pygame.locals.QUIT:
                game_over = True
            elif event.type == pygame.locals.KEYDOWN:
                pressed_key = event.key
    
    